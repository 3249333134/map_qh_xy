{"version":3,"file":"WaterfallComponent.js","sources":["pages/index/components/WaterfallComponent.vue","/Volumes/是红尘呀/prj/map/map_xy_s/pages/index/components/WaterfallComponent.vue?type=component"],"sourcesContent":["<template>\n  <scroll-view \n    class=\"waterfall-container\" \n    :style=\"{ height: height + 'px', opacity: show ? 1 : 0 }\"\n    scroll-y\n    @scroll=\"onScroll\"\n    @scrolltolower=\"loadMoreItems\">\n    <view class=\"waterfall\">\n      <view class=\"waterfall-column\">\n        <card-component \n          v-for=\"(height, index) in leftColumnHeights\" \n          :key=\"'left' + index\"\n          :index=\"'left' + index\" \n          :style=\"{ '--card-height': height + 'rpx' }\"\n        />\n      </view>\n      <view class=\"waterfall-column\">\n        <card-component \n          v-for=\"(height, index) in rightColumnHeights\" \n          :key=\"'right' + index\"\n          :index=\"'right' + index\" \n          :style=\"{ '--card-height': height + 'rpx' }\"\n        />\n      </view>\n    </view>\n    <view v-if=\"isLoading\" class=\"loading\">加载中...</view>\n  </scroll-view>\n</template>\n\n<script>\nimport CardComponent from './CardComponent.vue'\n\nexport default {\n  name: 'WaterfallComponent',\n  components: {\n    CardComponent\n  },\n  props: {\n    height: {\n      type: Number,\n      default: 0\n    },\n    show: {\n      type: Boolean,\n      default: true\n    }\n  },\n  data() {\n    return {\n      leftColumnHeights: this.generateRandomHeights(10),\n      rightColumnHeights: this.generateRandomHeights(10),\n      isLoading: false\n    }\n  },\n  watch: {\n    // 监听高度变化，当高度增加时自动加载更多内容\n    height(newVal, oldVal) {\n      if (newVal > oldVal) {\n        this.checkAndLoadMore()\n      }\n    }\n  },\n  methods: {\n    onScroll(e) {\n      this.$emit('scroll', e)\n    },\n    generateRandomHeights(count) {\n      const heights = []\n      for (let i = 0; i < count; i++) {\n        // 生成150到300之间的随机高度\n        const min = 150\n        const max = 300\n        const height = Math.floor(Math.random() * (max - min + 1)) + min\n        heights.push(height)\n      }\n      return heights\n    },\n    // 检查并加载更多内容\n    checkAndLoadMore() {\n      // 计算当前内容总高度\n      const totalItems = this.leftColumnHeights.length + this.rightColumnHeights.length\n      \n      // 根据容器高度估算需要的卡片数量\n      const estimatedItemsNeeded = Math.ceil(this.height / 100) * 2 // 假设每个卡片平均高度为100px\n      \n      // 如果当前卡片数量不足以填充容器，加载更多\n      if (totalItems < estimatedItemsNeeded + 4) { // 多加载几个作为缓冲\n        this.loadMoreItems()\n      }\n    },\n    // 加载更多内容\n    loadMoreItems() {\n      if (this.isLoading) return\n      \n      this.isLoading = true\n      \n      // 模拟异步加载\n      setTimeout(() => {\n        // 为两列各添加5个新卡片\n        const newLeftItems = this.generateRandomHeights(5)\n        const newRightItems = this.generateRandomHeights(5)\n        \n        this.leftColumnHeights = [...this.leftColumnHeights, ...newLeftItems]\n        this.rightColumnHeights = [...this.rightColumnHeights, ...newRightItems]\n        \n        this.isLoading = false\n      }, 500)\n    }\n  }\n}\n</script>\n\n<style>\n.waterfall-container {\n  width: 100%;\n  flex: 1;\n  overflow-y: scroll;\n  -webkit-overflow-scrolling: touch;\n  transition: opacity 0.3s ease;\n  background-color: #f0f0f0;\n  position: relative;\n}\n\n.waterfall {\n  padding: 20rpx;\n  padding-bottom: 100rpx;\n  display: flex;\n  justify-content: space-between;\n  background-color: #f0f0f0;\n}\n\n.waterfall-column {\n  width: 48%;\n  display: flex;\n  flex-direction: column;\n}\n\n.loading {\n  text-align: center;\n  padding: 20rpx 0;\n  color: #999;\n  font-size: 24rpx;\n}\n</style>","import Component from '/Volumes/是红尘呀/prj/map/map_xy_s/pages/index/components/WaterfallComponent.vue'\nwx.createComponent(Component)"],"names":[],"mappings":";;AA8BA,MAAO,gBAAe,MAAW;AAEjC,MAAK,YAAU;AAAA,EACb,MAAM;AAAA,EACN,YAAY;AAAA,IACV;AAAA,EACD;AAAA,EACD,OAAO;AAAA,IACL,QAAQ;AAAA,MACN,MAAM;AAAA,MACN,SAAS;AAAA,IACV;AAAA,IACD,MAAM;AAAA,MACJ,MAAM;AAAA,MACN,SAAS;AAAA,IACX;AAAA,EACD;AAAA,EACD,OAAO;AACL,WAAO;AAAA,MACL,mBAAmB,KAAK,sBAAsB,EAAE;AAAA,MAChD,oBAAoB,KAAK,sBAAsB,EAAE;AAAA,MACjD,WAAW;AAAA,IACb;AAAA,EACD;AAAA,EACD,OAAO;AAAA;AAAA,IAEL,OAAO,QAAQ,QAAQ;AACrB,UAAI,SAAS,QAAQ;AACnB,aAAK,iBAAiB;AAAA,MACxB;AAAA,IACF;AAAA,EACD;AAAA,EACD,SAAS;AAAA,IACP,SAAS,GAAG;AACV,WAAK,MAAM,UAAU,CAAC;AAAA,IACvB;AAAA,IACD,sBAAsB,OAAO;AAC3B,YAAM,UAAU,CAAC;AACjB,eAAS,IAAI,GAAG,IAAI,OAAO,KAAK;AAE9B,cAAM,MAAM;AACZ,cAAM,MAAM;AACZ,cAAM,SAAS,KAAK,MAAM,KAAK,YAAY,MAAM,MAAM,EAAE,IAAI;AAC7D,gBAAQ,KAAK,MAAM;AAAA,MACrB;AACA,aAAO;AAAA,IACR;AAAA;AAAA,IAED,mBAAmB;AAEjB,YAAM,aAAa,KAAK,kBAAkB,SAAS,KAAK,mBAAmB;AAG3E,YAAM,uBAAuB,KAAK,KAAK,KAAK,SAAS,GAAG,IAAI;AAG5D,UAAI,aAAa,uBAAuB,GAAG;AACzC,aAAK,cAAc;AAAA,MACrB;AAAA,IACD;AAAA;AAAA,IAED,gBAAgB;AACd,UAAI,KAAK;AAAW;AAEpB,WAAK,YAAY;AAGjB,iBAAW,MAAM;AAEf,cAAM,eAAe,KAAK,sBAAsB,CAAC;AACjD,cAAM,gBAAgB,KAAK,sBAAsB,CAAC;AAElD,aAAK,oBAAoB,CAAC,GAAG,KAAK,mBAAmB,GAAG,YAAY;AACpE,aAAK,qBAAqB,CAAC,GAAG,KAAK,oBAAoB,GAAG,aAAa;AAEvE,aAAK,YAAY;AAAA,MAClB,GAAE,GAAG;AAAA,IACR;AAAA,EACF;AACF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC5GA,GAAG,gBAAgB,SAAS;"}